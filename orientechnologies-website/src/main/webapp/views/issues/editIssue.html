<div class="container-fluid edit-issue">
  <div class="row vertical-align">
    <div class="col-md-8">
      <h3 ng-hide="editingTitle">{{ issue.title}}</h3>

      <form ng-show="editingTitle">
        <input type="text" class="form-control" ng-model="newTitle">
      </form>
    </div>
    <div class="col-md-4">
      <div class="btn-group">
        <button class="btn btn-sm btn-default" ng-click="editingTitle = true; newTitle = issue.title"
                ng-show=" (!editingTitle && (isOwner || isMember))">Edit
        </button>
      </div>


      <div class="btn-group">
        <button class="btn btn-sm btn-success" ng-disabled="!newTitle" ng-click="changeTitle(newTitle)"
                ng-show="editingTitle">Save
        </button>
      </div>
      <div class="btn-group">
        <button class="btn btn-sm btn-warning" ng-click="editingTitle=false; newTitle = null"
                ng-show="editingTitle">
          Cancel
        </button>
      </div>
      <div class="btn-group">
        <button class="btn btn-sm btn-default" ng-click="escalateIssue()"
                ng-show="isOwnerClient">Escalate Issue
        </button>
      </div>
      <div class="btn-group">
        <a href="javascript:void(0)"
           ng-show="isMember && !editingTitle && issue.state == 'OPEN' && !issue.client.clientId"
           ng-click="markAsQuestion()"
           class="btn btn-sm btn-default">Mark as Question</a>
      </div>
      <div class="btn-group">
        <a href="javascript:void(0)" ng-show="(issue.number && isMember && !editingTitle)" ng-click="sync()"
           class="btn btn-sm btn-default">Sync
          Issue</a>
      </div>
      <div class="btn-group">
        <a href="#/issues/new" ng-hide="editingTitle" class="btn btn-sm btn-success">New Issue</a>
      </div>

    </div>
  </div>
  <div class="row">
    <div class="col-md-1 state">
      <h3><span class="label" ng-class="{ true : 'label-success',false : 'label-danger'}[issue.state == 'OPEN']">{{issue.state}}</span>
      </h3>
    </div>
    <div class="col-md-7">
      <div class="row">
        <div class="col-md-12">
          #{{issue.iid}} <a ng-show="issue.number"
                            href="{{githubIssue + '/' + issue.repository.name + '/issues/' + issue.number}}"
                            target="_blank"><span
          class="label label-warning">{{ issue.repository.name + '/' + issue.number }}</span> </a>
          <a ng-show="issue.number" href="javascript:void(0)" ng-click="copyIssueNumber()"><i
            class="fa fa-copy"></i></a>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <b>{{issue.user.name}}</b> opened this issue {{ issue.createdAt | fromNow}} <a
          href="#/clients/{{issue.user.clientId}}"><span class="label label-primary"
                                                         ng-show="issue.user.isClient">{{issue.user.clientName}}</span>
          <span class="label label-warning" ng-show="issue.dueTime">{{issue.dueTime | fromNow}}</span>
        </a>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <hr>
    </div>
  </div>
  <div class="row">

    <div class="col-md-9">
      <div class="row">
        <div class="col-md-1">
          <avatar dim="50" user="issue.user"></avatar>
        </div>
        <div class="col-md-11">
          <div class="panel panel-default" ng-controller="BodyController">

            <div class="panel-heading">
              <div class="row">
                <div class="col-md-10">
                  <b>{{issue.user.name}}</b> commented {{ issue.createdAt | fromNow}} <a
                  href="#/clients/{{issue.user.clientId}}"><span class="label label-primary"
                                                                 ng-show="issue.user.isClient">{{issue.user.clientName}}</span></a>
                </div>
                <div class="col-md-2">
                  <div class="pull-right">
                    <a href="javascript:void(0)" ng-click="edit()"
                       ng-hide="!(issue.user.name== currentUser.name || isMember)"><i
                      class="fa fa-edit"></i></a>
                  </div>
                </div>
              </div>
            </div>
            <div class="panel-body">
              <div vue-editor preview="preview" carriage="carriage" ng-model="issue.body"></div>
            </div>
            <div class="panel-footer clearfix" ng-show="!preview">

              <div class="pull-right">
                <div class="btn-group">
                  <button ng-click="cancelEditing()" class="btn btn-sm btn-danger">Cancel</button>
                </div>
                <div class="btn-group">
                  <button class="btn btn-sm btn-success " ng-click="patchComment()">Update Comment
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
      <div class="row events-list">
        <div ng-repeat="comment in comments">
          <div class="col-md-1">
            <div ng-if="!comment.event">
              <avatar dim="50" user="comment.user"></avatar>
            </div>

          </div>
          <div class="col-md-11">
            <div class="event" ng-if="!comment.event && $index == 0">

            </div>
            <div ng-if="!comment.event" class="">
              <ng-include src="'views/issues/comment.html'"></ng-include>
            </div>
            <div class="event" ng-if="!comment.event">

            </div>
            <div class="event" ng-if="comment.event">

              <ng-include src="getEventTpl(comment.event)"></ng-include>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-1">

        </div>
        <div class="col-md-11">
          <div class="panel panel-default panel-comment">
            <div class="panel-heading">Leave a Comment (Supports Markdown)</div>
            <div class="panel-body">
              <div class="container-fluid">
                <div class="row">
                  <div class="col-md-12">
                    <div vue-editor preview="false" placeholder="placeholder" carriage="carriage"
                         ng-model="newComment.body"></div>
                  </div>
                </div>
                <div class="row">

                  <div class="col-md-8 col-md-offset-4">
                    <div class="btn-group pull-right"
                         ng-show="issue.state == 'OPEN' && !isInWait() && (isMember || isSupport)">
                      <button class="btn btn-sm btn-success" ng-click="commentAndWait()">
                        Comment & wait for reply
                      </button>
                    </div>
                    <div class="btn-group pull-right">
                      <button class="btn btn-sm btn-success" ng-click="comment()">
                        Comment
                      </button>
                    </div>


                    <div class="btn-group pull-right">
                      <button class="btn btn-sm btn-default"
                              ng-show="issue.state == 'OPEN' && (isOwner || isMember || isSupport)"
                              ng-click="close()">
                        {{ closeComment ? 'Close and comment' : 'Close'}}
                      </button>
                      <button class="btn btn-sm btn-default"
                              ng-show="issue.state == 'CLOSED' && (isOwner || isMember || isSupport)"
                              ng-click="reopen()">
                        Reopen Issue
                      </button>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3 issue-sidebar">
      <div class="row" ng-show="isMember || isSupport">
        <div class="col-md-12">
          <button class="btn btn-transparent " data-placement="bottom-right" data-auto-close="1"
                  data-animation="none"
                  data-template="views/issues/popover/clients.html" title="{{popover.title}}"
                  data-content="{{popover.content}}" data-trigger="click" bs-popover>Client <i
            class="fa fa-gear pull-right"></i></button>
        </div>
        <div class="col-md-12 milestone" ng-show="issue.client">
          <span class="label label-default">
            {{issue.client.name}}
            <span ng-if="issue.client.supported">
              (Supported)
            </span>
            <span ng-if="!issue.client.supported">
              (Not Supported)
            </span>
             <span ng-if="issue.client.expired">
              (Expired)
            </span>
          </span>
        </div>
        <div class="col-md-12">
          <hr>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <button class="btn btn-transparent " ng-disabled="!isMember && !isSupport" data-placement="bottom-right"
                  data-template="views/issues/popover/scopes.html" title="{{popover.title}}"
                  data-content="{{popover.content}}" data-auto-close="1" data-trigger="click" bs-popover>Area
            <i
              class="fa fa-gear pull-right"></i></button>
        </div>
        <div class="col-md-12 milestone">
          <span ng-show="issue.scope" class="label label-default">{{issue.scope.name}}</span>
        </div>
        <div class="col-md-12">
          <hr>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <button class="btn btn-transparent " ng-disabled="!isMember && !isSupport" data-placement="bottom-right"
                  data-template="views/issues/popover/priorities.html" title="{{popover.title}}"
                  data-content="{{popover.content}}" data-auto-close="1" data-trigger="click" bs-popover>
            Priority <i
            class="fa fa-gear pull-right"></i></button>
        </div>
        <div class="col-md-12 milestone">
                    <span ng-show="issue.priority" style="background-color: #{{issue.priority.color}}"
                          class="label label-primary">{{issue.priority.name}}</span>
        </div>
        <div class="col-md-12">
          <hr>
        </div>
      </div>
      <div class="row issue-assignee">
        <div class="col-md-12">
          <button class="btn btn-transparent"
                  ng-disabled="!canAssignIssue()"
                  data-placement="bottom-right"
                  data-template="views/issues/popover/assignee.html" title="{{popover.title}}"
                  data-content="{{popover.content}}" data-auto-close="1" data-trigger="click" bs-popover>
            Assignee <i
            class="fa fa-gear pull-right"></i>
          </button>
        </div>
        <div class="col-md-12">
          <div ng-if="issue.assignee">
            <avatar class="issue-assignee-avatar" name="true" dim="20" user="issue.assignee">
            </avatar>
          </div>
        </div>

        <div class="col-md-12">
          <hr>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <button ng-show="issue.environment" data-auto-close="1" class="btn btn-transparent"
                  ng-disabled="!(isOwner || isMember)"
                  data-placement="left"
                  data-template="views/issues/popover/environmentEdit.html"
                  title="{{popover.title}}"
                  data-content="{{popover.content}}"
                  data-trigger="click"
                  bs-popover="issue">Environment <i
            class="fa fa-gear pull-right"></i></button>
          <button ng-hide="issue.environment" data-auto-close="1" class="btn btn-transparent"
                  ng-disabled="!(isOwner || isMember)"
                  data-placement="left"
                  data-template="views/issues/popover/environmentSelect.html"
                  title="{{popover.title}}"
                  data-content="{{popover.content}}"
                  data-trigger="click"
                  bs-popover="issue">Environment <i
            class="fa fa-gear pull-right"></i></button>
        </div>
        <div class="col-md-12 milestone">
        <span ng-show="issue.environment" data-auto-close="1" data-placement="top"
              data-template="views/issues/popover/environment.html" title="{{popover.title}}"
              data-content="{{popover.content}}" data-trigger="hover" bs-popover="issue.environment"
              class="label label-primary">{{issue.environment.name}}</span>
        </div>
        <div class="col-md-12">
          <hr>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <button class="btn btn-transparent" ng-disabled="!isMember && !isSupport" class="btn btn-lg btn-primary"
                  data-placement="bottom-right"
                  data-auto-close="1"
                  data-template="views/issues/popover/labels.html"
                  title="{{popover.title}}" data-content="{{popover.content}}" data-trigger="click"
                  bs-popover>Labels <i
            class="fa fa-gear pull-right"></i></button>
        </div>
        <div class="col-md-12">
          <div class="row">
            <div class="col-md-12 issue-label" ng-repeat="label in issue.labels">
              <span class="label" style="background-color: #{{label.color}}">{{label.name}}</span>
            </div>
          </div>
        </div>
        <div class="col-md-12">
          <hr>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <button class="btn btn-transparent" ng-disabled="!isMember && !isSupport" data-auto-close="1"
                  data-placement="bottom-right"
                  data-template="views/issues/popover/versions.html" title="{{popover.title}}"
                  data-content="{{popover.content}}" data-trigger="click" bs-popover>Affected Version <i
            class="fa fa-gear pull-right"></i></button>
        </div>
        <div class="col-md-12 milestone">
          <span ng-show="issue.version" class="label label-primary">{{issue.version.title}}</span>
        </div>
        <div class="col-md-12">
          <hr>
        </div>

      </div>
      <div class="row">
        <div class="col-md-12">
          <button class="btn btn-transparent " ng-disabled="!isMember" data-placement="bottom-right"
                  data-template="views/issues/popover/milestones.html" title="{{popover.title}}"
                  data-content="{{popover.content}}" data-auto-close="1" data-trigger="click" bs-popover>
            Resolve in
            Milestone <i
            class="fa fa-gear pull-right"></i></button>
        </div>
        <div class="col-md-12 milestone">
          <span ng-show="issue.milestone" class="label label-primary">{{issue.milestone.title}}</span>
        </div>
        <div class="col-md-12">
          <hr>
        </div>

      </div>
      <div class="row" ng-show="issue.confidential">
        <div class="col-md-12">
          <h5 class="text-center">Attachments (Max {{ max }} MB) </h5>
        </div>
        <div class="col-md-12">
          <ul class="list-group">
            <li ng-repeat="attachment in attachments | orderBy:'-mTime'" class="list-group-item attachment-group-item">

              <span class="badge" ng-click="removeAttachment(attachment)"><i class="fa fa-remove"></i></span>
              <a href="javascript:void(0)" class="attachment-name" data-trigger="hover" bs-tooltip
                 data-title="{{attachment.name}} ({{attachment.size | toMB}})" ng-click="downloadAttachment(attachment)"
                 target="_blank">
                {{attachment.name}}

              </a>
            </li>
          </ul>
        </div>
        <div class="col-md-12">
          <hr>
        </div>

      </div>
      <div class="row" ng-show="issue.confidential">

        <form class="dropzone" dropzone="dropzone" url="url">

        </form>

      </div>
    </div>
  </div>
</div>
